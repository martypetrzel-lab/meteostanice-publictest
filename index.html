import express from "express";
import fs from "fs";
import cors from "cors";

const app = express();
const PORT = process.env.PORT || 3000;

/* ================== CORS ================== */
app.use(cors({
  origin: [
    "https://martypetrzel-lab.github.io"
  ],
  methods: ["GET"],
}));

/* ================== STATE ================== */
const STATE_FILE = "./state.json";

function loadState() {
  return JSON.parse(fs.readFileSync(STATE_FILE, "utf8"));
}

/* ================== ROUTES ================== */
app.get("/state", (req, res) => {
  try {
    const state = loadState();
    res.json(state);
  } catch (e) {
    res.status(500).json({ error: "State load failed" });
  }
});

/* ================== START ================== */
app.listen(PORT, () => {
  console.log(`Meteostanice backend běží na portu ${PORT}`);
});
